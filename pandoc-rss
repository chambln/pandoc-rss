#!/usr/bin/env rc

printf '$meta-json$' > /tmp/pandoc-rss.json
printf %s\n > /tmp/pandoc-rss.xml (
	'<item>'
	'<title>$title$</title>'
	'<link>$linkprefix$</link>'
	'<guid>$linkprefix$</guid>'
	'$if(description)$'
	'<description>$description$</description>'
	'$endif$'
	'<pubDate>$date$</pubDate>'
	'</item>'
)

ifs='
'
prefix = $1
suffix = $2
shift 2
for (i in $*) {
	date = `{ date -u -d `{
		pandoc --template=/tmp/pandoc-rss.json $^i | jq -r .date
	} '+%a, %d %b %Y %T UTC' }
	linkprefix = $^prefix^`{ printf $^i | sed 's/\.\w*$//' }^$^suffix
	pandoc --template=/tmp/pandoc-rss.xml \
		-V linkprefix:$^linkprefix $^i \
		-V date:$^date
}
