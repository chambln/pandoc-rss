#!/usr/bin/env rc

printf '$meta-json$' > /tmp/pandoc-rss.json
printf %s\n > /tmp/pandoc-rss.xml (
	'<item>'
	'<title>$title$</title>'
	'<link>$guid$</link>'
	'<guid>$guid$</guid>'
	'$if(description)$'
	'<description>$description$</description>'
	'$endif$'
	'<pubDate>$date$</pubDate>'
	'</item>'
)

ifs='
'
guid = $1
shift
for (i in $*) {
	date = `{ date -u -d `{
		pandoc --template=/tmp/pandoc-rss.json $^i | jq -r .date
	} '+%a, %d %b %Y %T UTC' }
	id = $^guid^`{ printf $^i | sed 's/\.\w*$//' }
	pandoc --template=/tmp/pandoc-rss.xml -V guid:$^id $^i -V date:$^date
}
